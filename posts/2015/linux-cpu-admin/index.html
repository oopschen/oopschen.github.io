<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    
    <meta name="description" content="石头的博客.">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:domain" content="http://oopschen.github.io">
    
    <meta name="twitter:image" content="http://oopschen.github.io/tn.png">
    <meta name="twitter:title" property="og:title" itemprop="title name" content="Oopschen的日志">
    <meta name="twitter:description" property="og:description" itemprop="description" content="石头的博客.">
    <meta name="og:type" content="website">
    <meta name="og:url" content="http://oopschen.github.io">
    <meta name="og:image" itemprop="image primaryImageOfPage" content="http://oopschen.github.io/tn.png">
    
    <title>CPU在linux下的调试</title>
    <link rel="shortcut icon" href="http://oopschen.github.io/sam.ico" id="favicon">
    <link rel="stylesheet" href="http://oopschen.github.io/css/style.css">
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Didact+Gothic">
    
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous"></script>
    
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-49453400-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-49453400-1');
    </script>
    

</head>

</html>
<body><div class="wrap"><div class="section" id="title">CPU在linux下的调试</div><div class="section" id="content">Fri Dec 04, 2015 &#183; 206 words

<div><span id="tag"><a href="http://oopschen.github.io/tags/cpu">cpu</a></span><span id="tag"><a href="http://oopschen.github.io/tags/linux">linux</a></span><span id="tag"><a href="http://oopschen.github.io/tags/cpupower">cpupower</a></span></div><hr/>

<p>Window用多了,会对操作系统的一些基础知识有所淡忘.比如这期说的CPU Governor和CPU Frequency.最近误打误撞发现linux下需要对cpu做一些特殊的设置,才能使得cpu发挥最大的效能.</p>

<p>先介绍一个工具&ndash;<strong>CPUPower</strong>, CPUPower是linux下展示和设置cpu相关属性的工具.</p>

<h2 id="实验机器">实验机器</h2>

<p>cpu: i5-480m
笔记本: thinkpad x201 nn5, 2011年款</p>

<h2 id="应用cpupower">应用cpupower</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Bash" data-lang="Bash">  cpupower frequency-info  </code></pre></div>
<p>会看到如下的提示:</p>

<blockquote>
<p>analyzing CPU 0:
  driver: acpi-cpufreq<br />
  CPUs which run at the same hardware frequency: 0<br />
  CPUs which need to have their frequency coordinated by software: 0<br />
  maximum transition latency: 10.0 us.<br />
  hardware limits: 1.20 GHz - 2.67 GHz<br />
  available frequency steps: 2.67 GHz, 2.67 GHz, 2.53 GHz, 2.40 GHz, 2.27 GHz, 2.13 GHz, 2.00 GHz, 1.87 GHz, 1.73 GHz, 1.60 GHz, 1.47 GHz, 1.33 GHz, 1.20 GHz<br />
  available cpufreq governors: userspace, ondemand, performance<br />
  current policy: frequency should be within 1.20 GHz and 2.67 GHz.<br />
                  The governor &ldquo;performance&rdquo; may decide which speed to use<br />
                  within this range.<br />
  current CPU frequency is 2.67 GHz (asserted by call to hardware).<br />
  boost state support:<br />
    Supported: yes<br />
    Active: yes<br />
    2200 MHz max turbo 2 active cores<br />
    2200 MHz max turbo 1 active cores</p>
</blockquote>

<p>从上面的输出结果可以看出cpu使用的Governor是<strong>performance</strong>, 当前cpu频率是2.67GHz. CPU可用的Governor有userspace, ondemand, performance, cpu可用的频率有2.67 GHz, 2.67 GHz, 2.53 GHz, 2.40 GHz, 2.27 GHz, 2.13 GHz, 2.00 GHz, 1.87 GHz, 1.73 GHz, 1.60 GHz, 1.47 GHz, 1.33 GHz, 1.20 GHz.</p>

<h2 id="cpu-governor">CPU Governor</h2>

<table>
  <tr>
    <th>Governor</th>
    <th>说明</th>
  </tr>

  <tr>
    <td>performance</td>
    <td>使用scaling_min_freq和scaling_max_freq之间最高的频率</td>
  </tr>

  <tr>
    <td>ondemand</td>
    <td>根据当前cpu的繁忙程度调整cpu的频率</td>
  </tr>

  <tr>
    <td>userspace</td>
    <td>允许uid为root的用户设置cpu频率</td>
  </tr>
</table>

<h3 id="设置governor">设置Governor</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Bash" data-lang="Bash">    cpupower -c all frequency-set --governor performance</code></pre></div>
<p>使用如上命令设置cpu governor为performance</p>

<h3 id="设置频率">设置频率</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Bash" data-lang="Bash">    cpupower -c all frequency-set  -f <span style="color:#ae81ff">1</span>.33GHz</code></pre></div>
<p>使用如上命令设置cpu的频率为1.33GHz</p>

<h2 id="其他">其他</h2>

<p>使用过程中可能会遇到一个问题,当笔记本电脑没有接电池只接AC的时候,linux默认会使用最低频率.如想突破此限制,可以在内核启动参数中添加如下参数:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Bash" data-lang="Bash">    processor.ignore_ppc<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> </code></pre></div>
<p>此参数会忽略bios的限制.</p>
</div><div class="section bottom-menu"><hr/><p>
<a href="/posts">back</a>
 &#183;



<a href="/posts">博客日志</a>


&#183; <a href="/about">我是谁?</a>

&#183; <a href="http://oopschen.github.io">home</a></p></div><div class="section footer">石头, OOPS!!!</div></div></body>