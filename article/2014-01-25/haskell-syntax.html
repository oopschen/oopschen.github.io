<!DOCTYPE html>
<html lang="zh_CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Focused on Tech">
    <meta name="author" content="Mr.C">
    <title>Mr.C Blog</title>
    <link  rel="stylesheet" href="/css/bootstrap.css" /><link  rel="stylesheet" href="/css/clean-blog.css" />

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-49453400-1', 'oopschen.github.io');
  ga('send', 'pageview');
</script>
<script type="text/javascript">var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fb92e3fa3521db5146fa7ee476d69fa7f' type='text/javascript'%3E%3C/script%3E"));</script>


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script defer="defer"  src="/lib/html5shiv.js"></script><script defer="defer"  src="/lib/respond.min.js"></script>
    <![endif]-->
</head>

<body>


<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://oopschen.github.io/index.html">Mr.C Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                  <li><a href="/index.html">Blog</a></li>
                
                  <li><a href="/about.html">Profile</a></li>
                
                  <li><a href="/archive.html">Archive</a></li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


<!-- Page Header -->
<!-- Set your background image for this header on the line below. -->
<header class="intro-header" style="background-image: url('/img/home-bg.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Haskell学习笔记三--语法</h1>
                    <h2 class="subheading">
                      [技术]
                      
                    </h2>
                    <span class="meta">
                        Updated on@January 25th 2014, 15:36
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
              <p>这篇blog要记录下笔者在看haskell的BNF的种种, 希望能全面的了解haskell的语法规则.这里的语法规则主要指的是<a href="http://www.haskell.org/onlinereport/haskell2010/haskellch2.html#x7-140002" title="Haskell 2010 语法">Haskell 2010</a>.  </p>
<h1 id="lexeme-bnf-">Lexeme BNF  </h1>
<pre class="highlight"><code class="hljs livecodeserver">program    →    { lexeme | whitespace }
lexeme    →    qvarid | qconid | qvarsym | qconsym |    literal | special | reservedop | reservedid 
whitespace    →    whitestuff {whitestuff}
whitestuff    →    whitechar | comment | ncomment
whitechar    →    newline | vertab | <span class="hljs-constant">space</span> | <span class="hljs-constant">tab</span> | uniWhite
newline    →    <span class="hljs-constant">return</span> <span class="hljs-constant">linefeed</span> | <span class="hljs-constant">return</span> | <span class="hljs-constant">linefeed</span> | <span class="hljs-constant">formfeed</span>
<span class="hljs-constant">return</span>    →     <span class="hljs-operator">a</span> carriage <span class="hljs-constant">return</span>
<span class="hljs-constant">linefeed</span>    →     <span class="hljs-operator">a</span> <span class="hljs-built_in">line</span> feed
vertab    →     <span class="hljs-operator">a</span> vertical <span class="hljs-constant">tab</span>
<span class="hljs-constant">formfeed</span>    →     <span class="hljs-operator">a</span> form feed
<span class="hljs-constant">space</span>    →     <span class="hljs-operator">a</span> <span class="hljs-constant">space</span>
<span class="hljs-constant">tab</span>    →     <span class="hljs-operator">a</span> horizontal <span class="hljs-constant">tab</span>
uniWhite    →     <span class="hljs-keyword">any</span> Unicode <span class="hljs-keyword">character</span> defined <span class="hljs-keyword">as</span> whitespace 
</code></pre><p>上面的BNF定义了haskell的程序是由lexeme和whitespace组成的,lexeme也给出了他自己的定义.这里值得关注的是newline中包含formfeed的定义,也就是ascii值为12的字符.其他的和其他语言类似.</p>
<!-- more --> 
<p>再来看看对comment的定义:</p>
<pre class="highlight"><code class="hljs 1c">comment    →    dashes [ any⟨symbol⟩ {any} ] newline
dashes    →    -- {-}
opencom    →    {-
closecom    →    -}
ncomment    →    opencom ANY seq {ncomment ANY seq} closecom
ANY seq    →    {ANY }⟨{ANY } ( opencom <span class="hljs-string">| closecom ) {ANY }⟩</span>
ANY    →    graphic <span class="hljs-string">| whitechar</span>
any    →    graphic <span class="hljs-string">| space | tab</span>
graphic    →    small <span class="hljs-string">| large | symbol | digit | special | "</span> <span class="hljs-string">| '</span>
</code></pre><p>这里我们可以看出comment有两种格式,一种是以<em>--</em>开头到一行结束为comment, 另一种是以<em>{-</em>开头,并且可以包行多行,直到以<em>-}</em>结束的多行comment.注意,以dash方式进行comment的时候是要除掉symbol以外的any字符,至于symbol的定义,请接着往下看.  </p>
<pre class="highlight"><code class="hljs 1c">small    →    ascSmall <span class="hljs-string">| uniSmall | _</span>
ascSmall    →    a <span class="hljs-string">| b | … | z</span>
uniSmall    →     any Unicode lowercase letter
large    →    ascLarge <span class="hljs-string">| uniLarge</span>
ascLarge    →    A <span class="hljs-string">| B | … | Z</span>
uniLarge    →     any uppercase or titlecase Unicode letter
symbol    →    ascSymbol <span class="hljs-string">| uniSymbol⟨special | _ | "</span> <span class="hljs-string">| '⟩</span>
ascSymbol    →    ! <span class="hljs-string">| # | $ | % | &amp; | ⋆ | + | . | / | &lt; | = | &gt; | ? | @ |    \ | ^ | | | - | ~ | :</span>
uniSymbol    →     any Unicode symbol or punctuation
digit    →    ascDigit <span class="hljs-string">| uniDigit</span>
ascDigit    →    <span class="hljs-number">0</span> <span class="hljs-string">| 1 | … | 9</span>
uniDigit    →     any Unicode decimal digit
octit    →    <span class="hljs-number">0</span> <span class="hljs-string">| 1 | … | 7</span>
hexit    →    digit <span class="hljs-string">| A | … | F | a | … | f</span>
</code></pre><p>这里对symbol的定义是uniSymbol中除去<em>_</em>, <em>\&quot;</em>, 和<em>\&#39;</em>以外的字符, 以及ascSymbol指向的哪些字符.</p>
<p><strong>PS, 语法解析的时候应该是用贪婪的策略, 也就是越长匹配的语法越优先.比如解析器碰到==的时候, 应该把他识别为==而不是= =</strong>  </p>
<h1 id="-">变量名称和操作符  </h1>
<p>看了这么一大堆定义估计脑子都秀逗了, 所以我们来回忆下上面对lexeme的定义.</p>
<pre class="highlight"><code class="hljs smalltalk">lexeme    →    qvarid <span class="hljs-localvars">| qconid | qvarsym | qconsym |    literal | special | reservedop | reservedid 
</span></code></pre><p>接下来我们来看看这些子term到底是什么?  </p>
<pre class="highlight"><code class="hljs css"><span class="hljs-tag">qvarid</span>    →    <span class="hljs-attr_selector">[modid .]</span> <span class="hljs-tag">varid</span>
<span class="hljs-tag">qconid</span>    →    <span class="hljs-attr_selector">[modid .]</span> <span class="hljs-tag">conid</span>
<span class="hljs-tag">qtycon</span>    →    <span class="hljs-attr_selector">[modid .]</span> <span class="hljs-tag">tycon</span>
<span class="hljs-tag">qtycls</span>    →    <span class="hljs-attr_selector">[modid .]</span> <span class="hljs-tag">tycls</span>
<span class="hljs-tag">qvarsym</span>    →    <span class="hljs-attr_selector">[modid .]</span> <span class="hljs-tag">varsym</span>
<span class="hljs-tag">qconsym</span>    →    <span class="hljs-attr_selector">[modid .]</span> <span class="hljs-tag">consym</span>
</code></pre><p>那modid又是什么?  </p>
<pre class="highlight"><code class="hljs haskell"><span class="hljs-title">varid</span>                (variables)
<span class="hljs-title">conid</span>                (constructors)
<span class="hljs-title">tyvar</span>    →    varid        (<span class="hljs-typedef"><span class="hljs-keyword">type</span> variables)</span>
<span class="hljs-title">tycon</span>    →    conid        (<span class="hljs-typedef"><span class="hljs-keyword">type</span> constructors)</span>
<span class="hljs-title">tycls</span>    →    conid        (<span class="hljs-typedef"><span class="hljs-keyword">type</span> classes)</span>
<span class="hljs-title">modid</span>    →    {conid .} conid        (modules)
<span class="hljs-title">varsym</span>    →    ( symbol⟨:⟩ {symbol} )⟨reservedop | dashes⟩
<span class="hljs-title">consym</span>    →    ( : {symbol})⟨reservedop⟩
<span class="hljs-title">reservedop</span>    →    .. | : | :: | = | \ | | | &lt;- | -&gt; | @ | ~ | =&gt;
</code></pre><p>haskell在语言的规范中就定义了6中namespace:  </p>
<ol>
<li>variables </li>
<li>constructors</li>
<li>type variables</li>
<li>type constructors</li>
<li>type classes</li>
<li>module names</li>
</ol>
<p>其中variables和type variables必须以小写的字母或者下划线开头, 其他的namespace以大写字母开头.变量名称不能和type constructor的命名以及同作用域内的class同名.  </p>
<p>我们从上面的定义可以看出, varsym是一般的变量命名, 非:开头.而以:开头的名称是被当作为constructors.  </p>
<h1 id="-">数字语法  </h1>
<pre class="highlight"><code class="hljs cs"><span class="hljs-keyword">decimal</span>    →    digit{digit}
octal    →    octit{octit}
hexadecimal    →    hexit{hexit}
integer    →    <span class="hljs-keyword">decimal</span> |    <span class="hljs-number">0</span>o octal | <span class="hljs-number">0</span>O octal |    <span class="hljs-number">0</span>x hexadecimal | <span class="hljs-number">0</span>X hexadecimal
<span class="hljs-keyword">float</span>    →    <span class="hljs-keyword">decimal</span> . <span class="hljs-keyword">decimal</span> [exponent] |    <span class="hljs-keyword">decimal</span> exponent
exponent    →    (e | E) [+ | -] <span class="hljs-keyword">decimal</span>
</code></pre><p>上面的定义很清晰的解释了整型, 浮点, 八进制, 十六进制, 以及十进制的语法规则.</p>
<h1 id="-">字符串语法  </h1>
<pre class="highlight"><code class="hljs 1c">char    →    ' (graphic⟨' <span class="hljs-string">| \⟩ | space | escape⟨\&amp;⟩) '</span>
string    →    <span class="hljs-string">" {graphic⟨"</span> <span class="hljs-string">| \⟩ | space | escape | gap} "</span>
escape    →    \ ( charesc <span class="hljs-string">| ascii | decimal | o octal | x hexadecimal )</span>
charesc    →    a <span class="hljs-string">| b | f | n | r | t | v | \ | "</span> <span class="hljs-string">| ' | &amp;</span>
ascii    →    ^cntrl <span class="hljs-string">| NUL | SOH | STX | ETX | EOT | ENQ | ACK |    BEL | BS | HT | LF | VT | FF | CR | SO | SI | DLE |    DC1 | DC2 | DC3 | DC4 | NAK | SYN | ETB | CAN |    EM | SUB | ESC | FS | GS | RS | US | SP | DEL</span>
cntrl    →    ascLarge <span class="hljs-string">| @ | [ | \ | ] | ^ | _</span>
gap    →    \ whitechar {whitechar} \
</code></pre><p>这里比较奇葩的东西是<strong>gap</strong>, 他的作用其实就是逻辑行继续(不知道用什么词表达), 当一行的字符太多的时候我们在c语言中往往会用<strong>\</strong>来另起一行,而haskell则是用两个反斜杠和当中的空格表达这个意图.</p>
<h1 id="layout-">Layout  </h1>
<p>这个也是和其他语言相比比较奇怪的地方, Haskell既支持{, }, ; 等的语句和作用域的声明, 又支持类似python利用缩进表达作用域的声明.Layout指的就是python的缩进方式.  </p>
<p>当编译器碰到where, let, do, or of等关键字的时候,如果没有{字符, 那么自动采用layout的模式解析, 他会先在这些关键字之后插入一个{.<br>如果后续的lexeme缩进更多, 那么不做任何处理.<br>如果后续的lexeme缩进是一样的, 那么会插入一个字符<strong>;</strong>.
如果后续的lexeme缩进的少了, 那么会插入一个<strong>}</strong>.<br>当然如果语义上已经表示lexeme的结束,那么<strong>}</strong>就会被插入.  </p>
<pre class="highlight"><code class="hljs autohotkey">.... where  
<span class="hljs-label">f ::</span> Num <span class="hljs-literal">a</span> =&gt; <span class="hljs-literal">a</span> -&gt; <span class="hljs-literal">a</span>
<span class="hljs-label">f1 ::</span> Num <span class="hljs-literal">a</span> =&gt; <span class="hljs-literal">a</span> -&gt; <span class="hljs-literal">a</span>
</code></pre><p>就会被翻译成以下的代码:</p>
<pre class="highlight"><code class="hljs autohotkey">.... where  
{  
<span class="hljs-label">  f ::</span> Num <span class="hljs-literal">a</span> =&gt; <span class="hljs-literal">a</span> -&gt; <span class="hljs-literal">a</span><span class="hljs-comment">;</span>
<span class="hljs-label">  f1 ::</span> Num <span class="hljs-literal">a</span> =&gt; <span class="hljs-literal">a</span> -&gt; <span class="hljs-literal">a</span><span class="hljs-comment">;</span>
}
</code></pre>


              <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a><a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a><a href="#" class="bds_qq" data-cmd="qq" title="分享到QQ收藏"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"32"},"share":{},"image":{"viewList":["qzone","tsina","renren","weixin","tieba","douban","qq"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["qzone","tsina","renren","weixin","tieba","douban","qq"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>

              <hr>

              <script type="text/javascript"> var disqus_shortname = 'sangeshitou'; (function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script>


            </div>
        </div>
    </div>
</article>

<hr>
  </body>

  <script defer="defer"  src="/lib/jquery.min.js"></script><script defer="defer"  src="/lib/bootstrap.min.js"></script><script defer="defer"  src="/lib/clean-blog.min.js"></script>

  <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
</html>

